import http from "http"
import { Server } from "ws"

import app from "./app"
import config from "./config"

const { port, env } = config

const routeCoordinates = [
  { lat: 3.2063335121009007, lng: 101.58106775379179 },
  { lat: 3.2065049047426304, lng: 101.58062787151334 },
  { lat: 3.2065798890143586, lng: 101.5801343450546 },
  { lat: 3.2065906010527314, lng: 101.57995195484159 },
  { lat: 3.2065584649372814, lng: 101.57969446277616 },
  { lat: 3.206633449205079, lng: 101.5792867670059 },
  { lat: 3.206687009393, lng: 101.57896490192411 },
  { lat: 3.2067619936513707, lng: 101.57854647731779 },
  { lat: 3.2069226741865227, lng: 101.57808513736722 },
  { lat: 3.207051218596467, lng: 101.57769889926908 },
  { lat: 3.2072011870542902, lng: 101.57736630535123 },
  { lat: 3.2073832915806704, lng: 101.57703371143339 },
  { lat: 3.207693940403754, lng: 101.57663674449918 },
  { lat: 3.207918892940844, lng: 101.57635779476163 },
  { lat: 3.2090436548837262, lng: 101.57551021671293 },
  { lat: 3.209697087443984, lng: 101.57508106327055 },
  { lat: 3.2100612955748913, lng: 101.57527418231962 },
  { lat: 3.210243399591644, lng: 101.57553167438505 },
  { lat: 3.210971815334023, lng: 101.57643289661405 },
  { lat: 3.210693303493867, lng: 101.57674403285978 },
  { lat: 3.2106504555117046, lng: 101.57689423656461 },
  { lat: 3.210757575463707, lng: 101.57708735561368 },
  { lat: 3.2114538548778957, lng: 101.5772161016464 },
  { lat: 3.211903758246879, lng: 101.57750578022001 },
  { lat: 3.212364373395428, lng: 101.57796712017057 },
  { lat: 3.2130070918600664, lng: 101.57849283313749 },
  { lat: 3.213446282578115, lng: 101.57870740985868 },
  { lat: 3.214014016640876, lng: 101.57870740985868 },
  { lat: 3.2146995818805166, lng: 101.57886834239957 },
  { lat: 3.214945956775988, lng: 101.57908291912076 },
  { lat: 3.2151173479725115, lng: 101.57935114002225 },
  { lat: 3.2151601957671354, lng: 101.57961936092374 },
  { lat: 3.2154172824971328, lng: 101.58026309108732 },
  { lat: 3.2157172169335504, lng: 101.58068151569364 },
  { lat: 3.215995727402658, lng: 101.58100338077543 },
  { lat: 3.2164027810283815, lng: 101.58122868633268 },
  { lat: 3.217141904301715, lng: 101.58142180538175 },
  { lat: 3.218009570069154, lng: 101.58147544956205 },
  { lat: 3.218941506552048, lng: 101.58149690723417 },
  { lat: 3.2194449661364155, lng: 101.58160419559476 },
  { lat: 3.219905577878615, lng: 101.5818080434799 },
  { lat: 3.2201091039308984, lng: 101.58201189136503 },
  { lat: 3.2202483585748234, lng: 101.58232302761076 },
  { lat: 3.220419748879646, lng: 101.58268780803678 },
  { lat: 3.2205375796974907, lng: 101.58304185962675 },
  { lat: 3.220762529402781, lng: 101.58358903026578 },
  { lat: 3.2207411056234676, lng: 101.58388943767545 },
  { lat: 3.220516155913457, lng: 101.58342809772489 },
  { lat: 3.2203340537308414, lng: 101.58297748661039 },
  { lat: 3.22020551099411, lng: 101.5826556215286 },
  { lat: 3.2200448325503515, lng: 101.58230156993864 },
  { lat: 3.2198198826865423, lng: 101.58197970485685 },
  { lat: 3.219423542329393, lng: 101.58174367046354 },
  { lat: 3.2190379137257534, lng: 101.58169002628324 },
  { lat: 3.218555877765959, lng: 101.58167929744718 },
  { lat: 3.218073841578094, lng: 101.58169002628324 },
  { lat: 3.217559669393057, lng: 101.581647110939 },
  { lat: 3.217077632733999, lng: 101.5815934667587 },
  { lat: 3.2166063077802973, lng: 101.5815398225784 },
  { lat: 3.216349221350061, lng: 101.58138961887357 },
  { lat: 3.2160278632211208, lng: 101.58122868633268 },
  { lat: 3.2158029124706116, lng: 101.58098192310331 },
  { lat: 3.215427994442799, lng: 101.58054204082487 },
  { lat: 3.2152780271930896, lng: 101.58025236225126 },
  { lat: 3.2150637882266873, lng: 101.57980175113676 },
  { lat: 3.214924532874389, lng: 101.57930822467802 },
  { lat: 3.214828125311651, lng: 101.57916874980924 },
  { lat: 3.214613886250761, lng: 101.57897563076017 },
  { lat: 3.214228255827742, lng: 101.57886834239957 },
  { lat: 3.2139176089920984, lng: 101.57885761356351 },
  { lat: 3.213467706510756, lng: 101.5788361558914 },
  { lat: 3.2130285158019185, lng: 101.5786752233505 },
  { lat: 3.212739292548979, lng: 101.57848210430143 },
  { lat: 3.2123857973507786, lng: 101.5781709680557 },
  { lat: 3.211796638415089, lng: 101.5776667127609 },
  { lat: 3.211507414813166, lng: 101.57749505138395 },
  { lat: 3.2111217832164978, lng: 101.57730193233488 },
  { lat: 3.210757575463707, lng: 101.5772161016464 },
  { lat: 3.210446927571954, lng: 101.57708735561368 },
  { lat: 3.210436215573999, lng: 101.57699079608915 },
  { lat: 3.210971815334023, lng: 101.57650799846647 },
  { lat: 3.210007735563771, lng: 101.57533855533597 },
  { lat: 3.209664951426202, lng: 101.5751990804672 },
  { lat: 3.2089793828060658, lng: 101.57562823390958 },
  { lat: 3.20842235796354, lng: 101.57606811618803 },
  { lat: 3.207918892940844, lng: 101.57647581195829 },
  { lat: 3.207597532158405, lng: 101.5768727788925 },
  { lat: 3.207211899086163, lng: 101.57753796672819 },
  { lat: 3.2069548102905228, lng: 101.57821388339994 },
  { lat: 3.206804841796555, lng: 101.5787288675308 },
  { lat: 3.206665585318175, lng: 101.57941551303861 },
  { lat: 3.2066227371671636, lng: 101.57988758182523 },
  { lat: 3.206697721430254, lng: 101.58005924320219 },
  { lat: 3.2067619936513707, lng: 101.58031673526762 },
  { lat: 3.2067084334673925, lng: 101.58052058315275 },
  { lat: 3.2065691769758837, lng: 101.58086390590665 },
  { lat: 3.206440632505343, lng: 101.58117504215238 },
  { lat: 3.206322800059831, lng: 101.58113212680814 },
  { lat: 3.2063335121009007, lng: 101.58106775379179 },
]
let counter = -1

const server = http.createServer(app).listen(port, () => {
  console.log(`Server listening on port ${port} in ${env} mode...`)
})

const wss = new Server({ server })
wss.on("connection", (ws) => {
  console.log("Client connected")
  ws.on("close", () => console.log("Client disconnected"))
})

setInterval(() => {
  counter++
  const data = {
    position: routeCoordinates[counter % routeCoordinates.length],
  }
  wss.clients.forEach((client) => {
    client.send(JSON.stringify(data))
  })
}, 1000)
